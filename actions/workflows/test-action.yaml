---
version: '2.0'

stackstorm_demo.test-action:
  input:
    - trigger_body

  tasks:

    delegate:
      action: core.noop
      publish:
        trigger_details: "{{ _.trigger_body }}"
      on-success:
        - diagnose
        - blame

    diagnose:
      action: core.local
      input:
        cmd: >
          node index diagnose
        cwd: /opt/stackstorm/bin/stackstorm_demo_cli
      publish:
        diagnosis: "{{ task('diagnose').result.stdout }}"

    blame:
      action: core.local
      input:
        cmd: >
          node index blame
        cwd: /opt/stackstorm/bin/stackstorm_demo_cli
      publish:
        blamed: "{{ task('blame').result.stdout }}"

    # notify:
    #   action: email.send
    #   wait-for:
    #     - diagnose
    #     - blame
    #   input:
    #     body: >
    #       {{ _.diagnosis.result }}